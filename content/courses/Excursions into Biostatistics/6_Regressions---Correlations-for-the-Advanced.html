---
title: Regressions
subtitle: Correlations for the Advanced
date: "2021-02-27"
slug: Regressions - Correlations for the Advanced
categories: [Excursion into Biostatistics]
tags: [R, Statistics]
summary: 'These are exercises and solutions meant as a compendium to my talk on Regression Models.'
authors: [Erik Kusch]
lastmod: '2020-02-27'
featured: no
projects:
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
    number_sections: false
    fig_width: 8
linktitle: Regressions - Correlations for the Advanced
menu:
  Excursions:
    parent: Seminars
    weight: 6
# toc: true
type: docs
weight: 6
---


<div id="TOC">
<ul>
<li><a href="#theory">Theory</a></li>
<li><a href="#our-resarch-project">Our Resarch Project</a><ul>
<li><a href="#the-data">The Data</a></li>
<li><a href="#reading-the-data-into-r">Reading the Data into <code>R</code></a></li>
<li><a href="#hypotheses">Hypotheses</a></li>
</ul></li>
<li><a href="#r-environment"><code>R</code> Environment</a></li>
<li><a href="#linear-regression">Linear Regression</a><ul>
<li><a href="#climate-conditions">Climate Conditions</a></li>
<li><a href="#competition">Competition</a></li>
<li><a href="#predation">Predation</a></li>
<li><a href="#null-full-model">Null &amp; Full Model</a></li>
<li><a href="#summary-of-linear-regression">Summary of Linear Regression</a></li>
</ul></li>
<li><a href="#mixed-effect-models">Mixed Effect Models</a><ul>
<li><a href="#climate-conditions-1">Climate Conditions</a></li>
<li><a href="#competition-1">Competition</a></li>
<li><a href="#predation-1">Predation</a></li>
<li><a href="#full-model">Full Model</a></li>
<li><a href="#summary-of-mixed-effect-models">Summary of Mixed Effect Models</a></li>
</ul></li>
<li><a href="#generalised-linear-models">Generalised Linear Models</a></li>
<li><a href="#final-models">Final Models</a></li>
<li><a href="#sessioninfo">SessionInfo</a></li>
</ul>
</div>

<div id="theory" class="section level1">
<h1>Theory</h1>
<p>These are exercises and solutions meant as a compendium to my talk on Model Selection and Model Building.</p>
<p>I have prepared some <a href="/courses/Excursions-into-Biostatistics/Regressions---Correlations-for-the-Advanced.html">Lecture Slides</a> for this session.</p>
</div>
<div id="our-resarch-project" class="section level1">
<h1>Our Resarch Project</h1>
<p>Today, we are looking at a big (and entirely fictional) data base of the common house sparrow (<em>Passer domesticus</em>). In particular, we are interested in the <strong>Evolution of <em>Passer domesticus</em> in Response to Climate Change</strong> which was previously explained <a href="/courses/excursions-into-biostatistics/research-project/">here</a>.</p>
<div id="the-data" class="section level2">
<h2>The Data</h2>
<p>I have created a large data set for this exercise which is available <a href="/courses/Excursions-into-Biostatistics/Data.rar">here</a> and we previously cleaned up so that is now usable <a href="/courses/excursions-into-biostatistics/data-handling-and-data-assumptions/">here</a>.</p>
</div>
<div id="reading-the-data-into-r" class="section level2">
<h2>Reading the Data into <code>R</code></h2>
<p>Let’s start by reading the data into <code>R</code> and taking an initial look at it:</p>
<pre class="r"><code>Sparrows_df &lt;- readRDS(file.path(&quot;Data&quot;, &quot;SparrowDataClimate.rds&quot;))
head(Sparrows_df)</code></pre>
<pre><code>##   Index Latitude Longitude     Climate Population.Status Weight Height Wing.Chord Colour    Sex Nesting.Site Nesting.Height Number.of.Eggs Egg.Weight Flock Home.Range Predator.Presence Predator.Type
## 1    SI       60       100 Continental            Native  34.05  12.87       6.67  Brown   Male         &lt;NA&gt;             NA             NA         NA     B      Large               Yes         Avian
## 2    SI       60       100 Continental            Native  34.86  13.68       6.79   Grey   Male         &lt;NA&gt;             NA             NA         NA     B      Large               Yes         Avian
## 3    SI       60       100 Continental            Native  32.34  12.66       6.64  Black Female        Shrub          35.60              1       3.21     C      Large               Yes         Avian
## 4    SI       60       100 Continental            Native  34.78  15.09       7.00  Brown Female        Shrub          47.75              0         NA     E      Large               Yes         Avian
## 5    SI       60       100 Continental            Native  35.01  13.82       6.81   Grey   Male         &lt;NA&gt;             NA             NA         NA     B      Large               Yes         Avian
## 6    SI       60       100 Continental            Native  32.36  12.67       6.64  Brown Female        Shrub          32.47              1       3.17     E      Large               Yes         Avian
##       TAvg      TSD
## 1 269.9596 15.71819
## 2 269.9596 15.71819
## 3 269.9596 15.71819
## 4 269.9596 15.71819
## 5 269.9596 15.71819
## 6 269.9596 15.71819</code></pre>
</div>
<div id="hypotheses" class="section level2">
<h2>Hypotheses</h2>
<p>Let’s remember our hypotheses:</p>
<ol style="list-style-type: decimal">
<li><strong>Sparrow Morphology</strong> is determined by:<br />
A. <em>Climate Conditions</em> with sparrows in stable, warm environments fairing better than those in colder, less stable ones.<br />
B. <em>Competition</em> with sparrows in small flocks doing better than those in big flocks.<br />
C. <em>Predation</em> with sparrows under pressure of predation doing worse than those without.<br />
</li>
<li><strong>Sites</strong> accurately represent <strong>sparrow morphology</strong>. This may mean:<br />
A. <em>Population status</em> as inferred through morphology.<br />
B. <em>Site index</em> as inferred through morphology.<br />
C. <em>Climate</em> as inferred through morphology.</li>
</ol>
<p>Quite obviously, <strong>hypothesis 1</strong> is the only one lending itself well to regression exercises. Since we have three variables that describe sparrow morphology (<code>Weight</code>, <code>Height</code>, <code>Wing.Chord</code>) and multi-response-variable models are definitely above the pay-grade of this material, we need to select one of our morphology variables as our response variable here. Remembering the <a href="/courses/excursions-into-biostatistics/classifications-order-from-chaos/">Classification exercise</a>, we recall that <code>Weight</code> was the most informative morphological trait so far. Hence, we stick with this one for these exercises.</p>
</div>
</div>
<div id="r-environment" class="section level1">
<h1><code>R</code> Environment</h1>
<p>For this exercise, we will need the following packages:</p>
<pre class="r"><code>install.load.package &lt;- function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, repos = &quot;http://cran.us.r-project.org&quot;)
  }
  require(x, character.only = TRUE)
}
package_vec &lt;- c(
  &quot;ggplot2&quot;, # for visualisation
  &quot;nlme&quot;, # for mixed effect models
  &quot;HLMdiag&quot; # for leverage of mixed effect models
)
sapply(package_vec, install.load.package)</code></pre>
<pre><code>## ggplot2    nlme HLMdiag 
##    TRUE    TRUE    TRUE</code></pre>
<p>Using the above function is way more sophisticated than the usual <code>install.packages()</code> &amp; <code>library()</code> approach since it automatically detects which packages require installing and only install these thus not overwriting already installed packages.</p>
</div>
<div id="linear-regression" class="section level1">
<h1>Linear Regression</h1>
<p>Remember the <strong>Assumptions of Linear Regression</strong>:</p>
<ol style="list-style-type: decimal">
<li>Variable values follow homoscedasticity (equal variance across entire data range)<br />
</li>
<li>Residuals follow normal distribution (normality)<br />
</li>
<li>Absence of influential outliers<br />
</li>
<li>Response and Predictor are related in a linear fashion</li>
</ol>
<div id="climate-conditions" class="section level2">
<h2>Climate Conditions</h2>
<div id="weight-as-a-result-of-average-temperature-tavg" class="section level3">
<h3><code>Weight</code> as a result of average temperature (<code>TAvg</code>)</h3>
<p>Before we begin, let’s plot the data we want to model:</p>
<pre class="r"><code>ggplot(data = Sparrows_df, aes(y = Weight, x = TAvg)) +
  stat_smooth(method = &quot;lm&quot;) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-3-1.png" width="1440" />
I have an inkling that we might run into some issues here, but let’s continue for now:</p>
<p>Let’s build the actual model:</p>
<pre class="r"><code>H1_ClimateTavg &lt;- lm(Weight ~ TAvg, data = Sparrows_df)
par(mfrow = c(2, 2))
plot(H1_ClimateTavg)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-4-1.png" width="1440" />
While the meeting of most of the assumptions here might be debatable, we certainly cannot accept a linear model with residuals this non-normal distributed. Sow hat do we? We try to remove as many confounding effects as possible!</p>
<p>Remember the plot-locations, climates, and population statues in the data set (go back <a href="/courses/excursions-into-biostatistics/research-project/">here</a> in necessary). How about we look exclusively at stations in the Americas which are all housing introduced sparrow populations and almost exclusively lie in coastal habitats? I’ll remove all non-coastal climate sites and only consider the central and North America here. Let’s do that:</p>
<pre class="r"><code># everything west of -7° is on the Americas
# every that&#39;s coastal climate type is retained
# everything north of 11° is central and north America
CentralNorthAm_df &lt;- Sparrows_df[Sparrows_df$Longitude &lt; -7 &amp; Sparrows_df$Climate == &quot;Coastal&quot; &amp; Sparrows_df$Latitude &gt; 11, ]
ggplot(data = CentralNorthAm_df, aes(y = Weight, x = TAvg)) +
  stat_smooth(method = &quot;lm&quot;) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-5-1.png" width="1440" /></p>
<pre class="r"><code>H1_ClimateTavg &lt;- lm(Weight ~ TAvg, data = CentralNorthAm_df)
par(mfrow = c(2, 2))
plot(H1_ClimateTavg)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-5-2.png" width="1440" />
This looks sensible to me! The scatterplot shows that sparrows are lighter in warmer areas which makes sense to me.</p>
<pre class="r"><code>summary(H1_ClimateTavg)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ TAvg, data = CentralNorthAm_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.1440 -1.0861  0.0219  0.9823  3.9743 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 45.167990   1.618752  27.903  &lt; 2e-16 ***
## TAvg        -0.049501   0.005635  -8.785 2.63e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.404 on 248 degrees of freedom
## Multiple R-squared:  0.2373, Adjusted R-squared:  0.2343 
## F-statistic: 77.18 on 1 and 248 DF,  p-value: 2.633e-16</code></pre>
<p>Our model estimates show the same pattern.</p>
</div>
<div id="weight-as-a-result-of-temperature-variability-tsd" class="section level3">
<h3><code>Weight</code> as a result of temperature variability (<code>TSD</code>)</h3>
<p>I’ll continue with my North American, coastal subset here:</p>
<pre class="r"><code># everything west of -7° is on the Americas
# every that&#39;s coastal climate type is retained
# everything north of 11° is central and north America
CentralNorthAm_df &lt;- Sparrows_df[Sparrows_df$Longitude &lt; -7 &amp; Sparrows_df$Climate == &quot;Coastal&quot; &amp; Sparrows_df$Latitude &gt; 11, ]
ggplot(data = CentralNorthAm_df, aes(y = Weight, x = TSD)) +
  stat_smooth(method = &quot;lm&quot;) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-7-1.png" width="1440" /></p>
<pre class="r"><code>H1_ClimateTSD &lt;- lm(Weight ~ TSD, data = CentralNorthAm_df)
par(mfrow = c(2, 2))
plot(H1_ClimateTSD)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-7-2.png" width="1440" /></p>
<pre class="r"><code>summary(H1_ClimateTSD)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ TSD, data = CentralNorthAm_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.7978 -1.0053  0.0002  1.0042  3.5648 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 29.61266    0.14922  198.45   &lt;2e-16 ***
## TSD          0.22680    0.02069   10.96   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.319 on 248 degrees of freedom
## Multiple R-squared:  0.3263, Adjusted R-squared:  0.3236 
## F-statistic: 120.1 on 1 and 248 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Again all assumptions are met and the model itself is very intuitive: The more variable the climate, the heavier the sparrows.</p>
</div>
<div id="weight-as-a-result-of-both-temperature-mean-tavg-and-temperature-variability-tsd" class="section level3">
<h3><code>Weight</code> as a result of both temperature mean (<code>TAvg</code>) and temperature variability (<code>TSD</code>)</h3>
<p>Naturally, we continue with the same subset of the data as before:</p>
<pre class="r"><code># everything west of -7° is on the Americas
# every that&#39;s coastal climate type is retained
# everything north of 11° is central and north America
CentralNorthAm_df &lt;- Sparrows_df[Sparrows_df$Longitude &lt; -7 &amp; Sparrows_df$Climate == &quot;Coastal&quot; &amp; Sparrows_df$Latitude &gt; 11, ]
H1_ClimateCont &lt;- lm(Weight ~ TAvg + TSD, data = CentralNorthAm_df)
par(mfrow = c(2, 2))
plot(H1_ClimateCont)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-8-1.png" width="1440" /></p>
<pre class="r"><code>summary(H1_ClimateCont)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ TAvg + TSD, data = CentralNorthAm_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.6593 -1.0263  0.0272  0.9207  3.2359 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 16.59866    4.68943   3.540 0.000479 ***
## TAvg         0.04215    0.01518   2.777 0.005915 ** 
## TSD          0.38142    0.05931   6.431 6.52e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.302 on 247 degrees of freedom
## Multiple R-squared:  0.3467, Adjusted R-squared:  0.3414 
## F-statistic: 65.54 on 2 and 247 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Interestingly, average temperature has a different (and weaker) effect now than when investigated in isolation. Variability of temperature has become even more important (i.e. stronger effect). So which model should we use? That’s exactly what we’ll investigate in our session on <a href="/courses/excursions-into-biostatistics/excursion-into-biostatistics/">Model Selection and Validation</a>!</p>
</div>
</div>
<div id="competition" class="section level2">
<h2>Competition</h2>
<p>Next, we build models which aim to explain sparrow <code>Weight</code> through variables pertaining to competition. To do so, I first calculate the size for each flock at each site and append these to each bird:</p>
<pre class="r"><code>FlockSizes &lt;- with(Sparrows_df, table(Flock, Index))
Sparrows_df$Flock.Size &lt;- NA
for (Flock_Iter in rownames(FlockSizes)) { # loop over flocks
  for (Site_Iter in colnames(FlockSizes)) { # loop over sites
    Positions &lt;- Sparrows_df$Index == Site_Iter &amp; Sparrows_df$Flock == Flock_Iter
    Sparrows_df$Flock.Size[Positions] &lt;- FlockSizes[Flock_Iter, Site_Iter]
  }
}</code></pre>
<p>With that done, we can now build our models up again like we did with the climate data before.</p>
<div id="weight-as-a-result-of-home-range-size-home.range" class="section level3">
<h3><code>Weight</code> as a result of Home Range size (<code>Home.Range</code>)</h3>
<pre class="r"><code>ggplot(data = Sparrows_df, aes(x = Home.Range, y = Weight)) +
  geom_boxplot() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-10-1.png" width="1440" /></p>
<pre class="r"><code>H1_CompetitionHR &lt;- lm(Weight ~ Home.Range, data = Sparrows_df)
par(mfrow = c(2, 2))
plot(H1_CompetitionHR)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-10-2.png" width="1440" />
Nope. Those residuals have me nope out. We won’t use this model.</p>
</div>
<div id="weight-as-a-result-of-flock-size-size-flock.size" class="section level3">
<h3><code>Weight</code> as a result of Flock Size size (<code>Flock.Size</code>)</h3>
<pre class="r"><code>ggplot(data = Sparrows_df, aes(x = Flock.Size, y = Weight)) +
  stat_smooth(method = &quot;lm&quot;) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-11-1.png" width="1440" /></p>
<pre class="r"><code>H1_CompetitionFS &lt;- lm(Weight ~ Flock.Size, data = Sparrows_df)
par(mfrow = c(2, 2))
plot(H1_CompetitionFS)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-11-2.png" width="1440" /></p>
<pre class="r"><code>summary(H1_CompetitionFS)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ Flock.Size, data = Sparrows_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.7421 -1.2163  0.0961  1.2823  4.7176 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 35.456378   0.114500   309.7   &lt;2e-16 ***
## Flock.Size  -0.237908   0.003831   -62.1   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.893 on 1064 degrees of freedom
## Multiple R-squared:  0.7838, Adjusted R-squared:  0.7836 
## F-statistic:  3857 on 1 and 1064 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Now that’s a neat model! Not only do the diagnostics plot look spot-on (not showing these here), the relationship is strong and clear to see - the bigger the flock, the lighter the sparrow.</p>
</div>
<div id="weight-as-a-result-of-home-range-size-home.range-and-flock-size-size-flock.size" class="section level3">
<h3><code>Weight</code> as a result of Home Range size (<code>Home.Range</code>) and Flock Size size (<code>Flock.Size</code>)</h3>
<pre class="r"><code>ggplot(data = Sparrows_df, aes(x = Flock.Size, y = Weight, col = Home.Range)) +
  geom_point() +
  stat_smooth(method = &quot;lm&quot;) +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-12-1.png" width="1440" /></p>
<pre class="r"><code>H1_CompetitionFULL &lt;- lm(Weight ~ Home.Range * Flock.Size, data = Sparrows_df)
par(mfrow = c(2, 2))
plot(H1_CompetitionFULL)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-12-2.png" width="1440" /></p>
<pre class="r"><code>summary(H1_CompetitionFULL)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ Home.Range * Flock.Size, data = Sparrows_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.5599 -1.2261  0.0427  1.2806  4.5553 
## 
## Coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                 33.29279    0.31986 104.086  &lt; 2e-16 ***
## Home.RangeMedium             0.29700    0.89288   0.333    0.739    
## Home.RangeSmall              1.88176    0.35265   5.336 1.16e-07 ***
## Flock.Size                  -0.07337    0.01848  -3.970 7.66e-05 ***
## Home.RangeMedium:Flock.Size -0.03363    0.05787  -0.581    0.561    
## Home.RangeSmall:Flock.Size  -0.16211    0.01896  -8.548  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.8 on 1060 degrees of freedom
## Multiple R-squared:  0.8051, Adjusted R-squared:  0.8042 
## F-statistic:   876 on 5 and 1060 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We see that our model is unsure of what to do with the home ranges when it comes to medium-sized ranges. The scatterplot shows that is is probably due to us not having a lot of samples for medium-sized home-ranges. Aside from that, our model meets all assumptions and produces quite intuitive parameter estimates.</p>
</div>
</div>
<div id="predation" class="section level2">
<h2>Predation</h2>
<p>Next, we look at sparrow <code>Weight</code> through the lens of predation. To do so, we need to recode all <code>NA</code>s in the <code>Predator.Type</code> variable into something else for our models ro tun properly. I chose <code>"None"</code> here to indicate that there is no predation-pressure at these sites:</p>
<pre class="r"><code>levels(Sparrows_df$Predator.Type) &lt;- c(levels(Sparrows_df$Predator.Type), &quot;None&quot;)
Sparrows_df$Predator.Type[is.na(Sparrows_df$Predator.Type)] &lt;- &quot;None&quot;</code></pre>
<p>With that taken care of, we again build our models one-by-one.</p>
<p>Again, because of issues with normality of residuals, we default to our three sites across Central and North America, which are of coastal climate:</p>
<pre class="r"><code># everything west of -7° is on the Americas
# every that&#39;s coastal climate type is retained
# everything north of 11° is central and north America
CentralNorthAm_df &lt;- Sparrows_df[Sparrows_df$Longitude &lt; -7 &amp; Sparrows_df$Climate == &quot;Coastal&quot; &amp; Sparrows_df$Latitude &gt; 11, ]</code></pre>
<div id="weight-as-a-result-of-predator.presence" class="section level3">
<h3><code>Weight</code> as a result of <code>Predator.Presence</code></h3>
<pre class="r"><code>ggplot(data = CentralNorthAm_df, aes(x = Predator.Presence, y = Weight)) +
  geom_boxplot() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-15-1.png" width="1440" /></p>
<pre class="r"><code>H1_PredationPresence &lt;- lm(Weight ~ Predator.Presence, data = CentralNorthAm_df)
par(mfrow = c(2, 2))
plot(H1_PredationPresence)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-15-2.png" width="1440" /></p>
<pre class="r"><code>summary(H1_PredationPresence)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ Predator.Presence, data = CentralNorthAm_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.5051 -1.0701 -0.0396  1.0749  4.2549 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           31.4141     0.1752 179.261  &lt; 2e-16 ***
## Predator.PresenceYes  -0.6589     0.2131  -3.092  0.00222 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.577 on 248 degrees of freedom
## Multiple R-squared:  0.03711,    Adjusted R-squared:  0.03323 
## F-statistic: 9.557 on 1 and 248 DF,  p-value: 0.002219</code></pre>
<p>According to our model, sparrows under pressure of predation are lighter than those which aren’t. Does that make sense? Intuitively, yes, but I would argue that there are too many confounding variable here to be sure.</p>
</div>
<div id="weight-as-a-result-of-predator.type" class="section level3">
<h3><code>Weight</code> as a result of <code>Predator.Type</code></h3>
<pre class="r"><code>ggplot(data = CentralNorthAm_df, aes(x = Predator.Type, y = Weight)) +
  geom_boxplot() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-16-1.png" width="1440" /></p>
<pre class="r"><code>H1_PredationType &lt;- lm(Weight ~ Predator.Type, data = CentralNorthAm_df)
par(mfrow = c(2, 2))
plot(H1_PredationType)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-16-2.png" width="1440" /></p>
<pre class="r"><code>summary(H1_PredationType)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ Predator.Type, data = CentralNorthAm_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.6593 -1.0263  0.0272  0.9207  3.2359 
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)             29.9093     0.1270 235.439  &lt; 2e-16 ***
## Predator.TypeNon-Avian   2.2335     0.2064  10.819  &lt; 2e-16 ***
## Predator.TypeNone        1.5047     0.1925   7.817 1.56e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.302 on 247 degrees of freedom
## Multiple R-squared:  0.3467, Adjusted R-squared:  0.3414 
## F-statistic: 65.54 on 2 and 247 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>OK. This clearly shows that there are either some confounds present or that our data shows something very counter-intuitive. Sparrows under nor predation are lighter than sparrows under non-avian predation? That makes no sense to me.</p>
</div>
<div id="weight-as-a-result-of-predator.presence-and-predator.type" class="section level3">
<h3><code>Weight</code> as a result of <code>Predator.Presence</code> and <code>Predator.Type</code></h3>
<pre class="r"><code>ggplot(data = CentralNorthAm_df, aes(x = Predator.Presence, y = Weight, fill = Predator.Type)) +
  geom_boxplot() +
  theme_bw()</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-17-1.png" width="1440" /></p>
<pre class="r"><code>H1_PredationFULL &lt;- lm(Weight ~ Predator.Presence + Predator.Type, data = Sparrows_df)
par(mfrow = c(2, 2))
plot(H1_PredationFULL)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-17-2.png" width="1440" /></p>
<pre class="r"><code>summary(H1_PredationFULL)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ Predator.Presence + Predator.Type, data = Sparrows_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.6635 -2.2987 -0.0844  1.9563  9.6165 
## 
## Coefficients: (1 not defined because of singularities)
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)             30.6145     0.1816  168.60   &lt;2e-16 ***
## Predator.PresenceYes    -3.5709     0.2387  -14.96   &lt;2e-16 ***
## Predator.TypeNon-Avian   5.2809     0.2789   18.94   &lt;2e-16 ***
## Predator.TypeNone            NA         NA      NA       NA    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.431 on 1063 degrees of freedom
## Multiple R-squared:  0.2901, Adjusted R-squared:  0.2888 
## F-statistic: 217.2 on 2 and 1063 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Those residuals don’t look good, but that’s not what I am after with this model. Immediately, we should notice that our model returns <code>NA</code> for the parameter estimate of <code>Predator.TypeNone</code>. Why does that happen? Because <code>Predator.TypeNone</code> coincides with <code>Predator.PresenceNo</code> (the <code>Intercept</code>) of this model and so does not provide any additional information. In fact, <code>Predator.Type</code> offers all the information of <code>Predator.Presence</code> and then some! Consequently, including both in a model does not make sense and we can immediately disqualify this model.</p>
</div>
</div>
<div id="null-full-model" class="section level2">
<h2>Null &amp; Full Model</h2>
<p>For some comparison further down the line, we need a null model:</p>
<pre class="r"><code>H1_Null_Sparrows &lt;- lm(Weight ~ 1, data = Sparrows_df)
H1_Null_CNA &lt;- lm(Weight ~ 1, data = CentralNorthAm_df)</code></pre>
<p>Our full model contains all of our aforementioned variables/parameters to the best of our knowledge/intuition at this point. We will get to making this model better later. Don’t worry:</p>
<pre class="r"><code>H1_FULL_Sparrows &lt;- lm(Weight ~ Climate + TAvg + TSD + Home.Range * Flock.Size + Predator.Type, data = Sparrows_df)
par(mfrow = c(2, 2))
plot(H1_FULL_Sparrows)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-19-1.png" width="1440" /></p>
<pre class="r"><code>summary(H1_FULL_Sparrows)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ Climate + TAvg + TSD + Home.Range * Flock.Size + 
##     Predator.Type, data = Sparrows_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2164 -1.0436  0.0939  1.0495  4.7403 
## 
## Coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                 43.65271    4.09482  10.660  &lt; 2e-16 ***
## ClimateContinental           2.28851    0.31524   7.259 7.53e-13 ***
## ClimateSemi-Coastal         -0.79097    0.30663  -2.580  0.01003 *  
## TAvg                        -0.04252    0.01402  -3.034  0.00247 ** 
## TSD                          0.01431    0.04032   0.355  0.72272    
## Home.RangeMedium             1.63110    0.85370   1.911  0.05632 .  
## Home.RangeSmall              2.36146    0.41639   5.671 1.83e-08 ***
## Flock.Size                  -0.03445    0.01896  -1.817  0.06955 .  
## Predator.TypeNon-Avian       0.24253    0.16673   1.455  0.14605    
## Predator.TypeNone            0.75123    0.17268   4.350 1.49e-05 ***
## Home.RangeMedium:Flock.Size -0.10115    0.05614  -1.802  0.07186 .  
## Home.RangeSmall:Flock.Size  -0.16452    0.01990  -8.267 4.09e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.605 on 1054 degrees of freedom
## Multiple R-squared:  0.846,  Adjusted R-squared:  0.8444 
## F-statistic: 526.6 on 11 and 1054 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Already at this point, it is interesting to point out how some previously non-significant effects drop out while other become significant due to the inclusion of all parameters in one model.</p>
<p>Now we also need a full model for our Central-/North-America data:</p>
<pre class="r"><code>H1_FULL_CNA &lt;- lm(Weight ~ TAvg + TSD + Home.Range * Flock.Size + Predator.Type, data = CentralNorthAm_df)
par(mfrow = c(2, 2))
plot(H1_FULL_CNA)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-20-1.png" width="1440" /></p>
<pre class="r"><code>summary(H1_FULL_CNA)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Weight ~ TAvg + TSD + Home.Range * Flock.Size + 
##     Predator.Type, data = CentralNorthAm_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.6979 -0.9364 -0.0501  1.0483  3.3590 
## 
## Coefficients: (2 not defined because of singularities)
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                 14.18473    6.20215   2.287   0.0231 *  
## TAvg                         0.05336    0.02038   2.618   0.0094 ** 
## TSD                          0.39853    0.07842   5.082 7.48e-07 ***
## Home.RangeMedium            -3.83588    1.99164  -1.926   0.0553 .  
## Home.RangeSmall             -1.50681    1.03368  -1.458   0.1462    
## Flock.Size                  -0.07581    0.05850  -1.296   0.1963    
## Predator.TypeNon-Avian            NA         NA      NA       NA    
## Predator.TypeNone                 NA         NA      NA       NA    
## Home.RangeMedium:Flock.Size  0.29821    0.13273   2.247   0.0256 *  
## Home.RangeSmall:Flock.Size   0.10097    0.06212   1.625   0.1054    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.285 on 242 degrees of freedom
## Multiple R-squared:  0.3765, Adjusted R-squared:  0.3585 
## F-statistic: 20.88 on 7 and 242 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="summary-of-linear-regression" class="section level2">
<h2>Summary of Linear Regression</h2>
<p>To streamline the next few steps of our exercise on <a href="/courses/excursions-into-biostatistics/excursion-into-biostatistics/">Model Selection and Validation</a>, we combine all of our models into a <code>list</code> object for now:</p>
<pre class="r"><code>H1_ModelSparrows_ls &lt;- list(
  H1_Null_Sparrows,
  H1_CompetitionFS,
  H1_CompetitionFULL,
  H1_FULL_Sparrows
)
names(H1_ModelSparrows_ls) &lt;- c(
  &quot;Null&quot;,
  &quot;Comp_Flock.Size&quot;, &quot;Comp_Full&quot;,
  &quot;Full&quot;
)
H1_ModelCNA_ls &lt;- list(
  H1_Null_CNA,
  H1_ClimateTavg,
  H1_ClimateTSD,
  H1_ClimateCont,
  H1_PredationPresence,
  H1_PredationType,
  H1_FULL_CNA
)
names(H1_ModelCNA_ls) &lt;- c(
  &quot;Null&quot;,
  &quot;Clim_TAvg&quot;, &quot;Clim_TSD&quot;, &quot;Clim_Full&quot;,
  &quot;Pred_Pres&quot;, &quot;Pred_Type&quot;,
  &quot;Full&quot;
)</code></pre>
</div>
</div>
<div id="mixed-effect-models" class="section level1">
<h1>Mixed Effect Models</h1>
<p>Remember the <strong>Assumptions of Mixed Effect Models</strong>:</p>
<ol style="list-style-type: decimal">
<li>Variable values follow homoscedasticity (equal variance across entire data range)<br />
</li>
<li>Residuals follow normal distribution (normality)<br />
</li>
<li>Absence of influential outliers<br />
</li>
<li>Response and Predictor are related in a linear fashion</li>
</ol>
<div id="climate-conditions-1" class="section level2">
<h2>Climate Conditions</h2>
<p>Here, I create a mixed effect model that is accounting predicting <code>Weight</code> with a combination <code>TAvg</code> and <code>TSD</code> while accounting for random intercepts of <code>Index</code> and <code>Population.Status</code>. As we learned in our exercise on <a href="(/courses/excursions-into-biostatistics/classifications-order-from-chaos/)">Classifications</a>, these two are probably important in controlling for some morphology effects in <code>Weight</code>.</p>
<p>I create such a model for:</p>
<ol style="list-style-type: decimal">
<li>The <strong>entire sparrow data data set</strong><br />
</li>
<li>Only the <strong>Central-/North-America sparrows</strong></li>
</ol>
<p>to make models comparable to our previous basic, linear models.</p>
<div id="global-model" class="section level3">
<h3>Global Model</h3>
<pre class="r"><code>H1_Climate_ME_Sparrows &lt;- lme(Weight ~ TAvg + TSD,
  random = list(
    Population.Status = ~1,
    Index = ~1
  ),
  data = Sparrows_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Climate_ME_Sparrows), resid(H1_Climate_ME_Sparrows)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Climate_ME_Sparrows), Sparrows_df$Weight) # Linearity, there is a clear pattern here --&gt; bad!
qqnorm(resid(H1_Climate_ME_Sparrows)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Climate_ME_Sparrows)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-22-1.png" width="1440" />
Quite evidently, the assumption of linearity is violated. Notice that we would not like to use this model for predictions, but will carry it forward for the purpose of subsequent <a href="/courses/excursions-into-biostatistics/excursion-into-biostatistics/">Model Selection and Validation</a>.</p>
<pre class="r"><code>summary(H1_Climate_ME_Sparrows)</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: Sparrows_df 
##        AIC      BIC    logLik
##   3557.109 3586.922 -1772.554
## 
## Random effects:
##  Formula: ~1 | Population.Status
##         (Intercept)
## StdDev: 0.001507855
## 
##  Formula: ~1 | Index %in% Population.Status
##         (Intercept) Residual
## StdDev:    2.640311 1.237155
## 
## Fixed effects:  Weight ~ TAvg + TSD 
##                Value Std.Error   DF    t-value p-value
## (Intercept) 37.83099 31.229059 1055  1.2114034  0.2260
## TAvg        -0.03070  0.104602    7 -0.2934692  0.7777
## TSD          0.27536  0.265143    7  1.0385452  0.3336
##  Correlation: 
##      (Intr) TAvg  
## TAvg -0.999       
## TSD  -0.826  0.809
## 
## Standardized Within-Group Residuals:
##          Min           Q1          Med           Q3          Max 
## -2.956660984 -0.746001839  0.004452834  0.722973350  2.617329146 
## 
## Number of Observations: 1066
## Number of Groups: 
##            Population.Status Index %in% Population.Status 
##                            2                           11</code></pre>
</div>
<div id="central-north-american-model" class="section level3">
<h3>Central-/North-American Model</h3>
<p>Accounting for population status in among the Central-/North-American sites makes no sense as all of them are introduced populations.</p>
<pre class="r"><code>H1_Climate_ME_CNA &lt;- lme(Weight ~ TAvg + TSD,
  random = list(Index = ~1),
  data = CentralNorthAm_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Climate_ME_CNA), resid(H1_Climate_ME_CNA)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Climate_ME_CNA), CentralNorthAm_df$Weight) # Linearity, there is no clear pattern here --&gt; good!
qqnorm(resid(H1_Climate_ME_CNA)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Climate_ME_CNA)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-24-1.png" width="1440" /></p>
<p>With this model, all of our assumption are met nicely!</p>
<pre class="r"><code>summary(H1_Climate_ME_CNA)</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: CentralNorthAm_df 
##        AIC      BIC    logLik
##   863.9566 881.5035 -426.9783
## 
## Random effects:
##  Formula: ~1 | Index
##         (Intercept) Residual
## StdDev:   0.3802608 1.301734
## 
## Fixed effects:  Weight ~ TAvg + TSD 
##                 Value Std.Error  DF   t-value p-value
## (Intercept) 16.598661 13.291655 247 1.2488031  0.2129
## TAvg         0.042146  0.042863   0 0.9832757     NaN
## TSD          0.381424  0.174011   0 2.1919464     NaN
##  Correlation: 
##      (Intr) TAvg  
## TAvg -0.999       
## TSD  -0.953  0.945
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -2.8111222 -0.7883782  0.0208856  0.7072618  2.4858581 
## 
## Number of Observations: 250
## Number of Groups: 3</code></pre>
</div>
</div>
<div id="competition-1" class="section level2">
<h2>Competition</h2>
<p>With competition effects as my goal, I can now include climate classification as one of the random effects! Of course, this is with the exception of the Central-/North-American data as all of these sites are of the type “Coastal”.</p>
<p>Again, we do so for a global and a local model:</p>
<div id="global-model-1" class="section level3">
<h3>Global Model</h3>
<pre class="r"><code>H1_Comp_ME_Sparrows &lt;- lme(Weight ~ Home.Range * Flock.Size,
  random = list(
    Population.Status = ~1,
    Climate = ~1
  ),
  data = Sparrows_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Comp_ME_Sparrows), resid(H1_Comp_ME_Sparrows)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Comp_ME_Sparrows), Sparrows_df$Weight) # Linearity, there is a clear pattern here --&gt; bad!
qqnorm(resid(H1_Comp_ME_Sparrows)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Comp_ME_Sparrows)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-26-1.png" width="1440" /></p>
</div>
<div id="central-north-american-model-1" class="section level3">
<h3>Central-/North-American Model</h3>
<pre class="r"><code>H1_Comp_ME_CNA &lt;- lme(Weight ~ Home.Range * Flock.Size,
  random = list(Climate = ~1),
  data = CentralNorthAm_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Comp_ME_CNA), resid(H1_Comp_ME_CNA)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Comp_ME_CNA), CentralNorthAm_df$Weight) # Linearity, there is no clear pattern here --&gt; good!
qqnorm(resid(H1_Comp_ME_CNA)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Comp_ME_CNA)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-27-1.png" width="1440" /></p>
</div>
</div>
<div id="predation-1" class="section level2">
<h2>Predation</h2>
<p>With predation effects, I do the same as with competition effects and set a random intercept for climate classification at each site for a global and a local model:</p>
<div id="global-model-2" class="section level3">
<h3>Global Model</h3>
<pre class="r"><code>H1_Pred_ME_Sparrows &lt;- lme(Weight ~ Predator.Type,
  random = list(
    Population.Status = ~1,
    Climate = ~1
  ),
  data = Sparrows_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Pred_ME_Sparrows), resid(H1_Pred_ME_Sparrows)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Pred_ME_Sparrows), Sparrows_df$Weight) # Linearity, there is a clear pattern here --&gt; bad!
qqnorm(resid(H1_Pred_ME_Sparrows)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Pred_ME_Sparrows)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-28-1.png" width="1440" /></p>
</div>
<div id="central-north-american-model-2" class="section level3">
<h3>Central-/North-American Model</h3>
<pre class="r"><code>H1_Pred_ME_CNA &lt;- lme(Weight ~ Predator.Type,
  random = list(Index = ~1),
  data = CentralNorthAm_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Pred_ME_CNA), resid(H1_Pred_ME_CNA)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Pred_ME_CNA), CentralNorthAm_df$Weight) # Linearity, there is no clear pattern here --&gt; good!
qqnorm(resid(H1_Pred_ME_CNA)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Pred_ME_CNA)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-29-1.png" width="1440" /></p>
</div>
</div>
<div id="full-model" class="section level2">
<h2>Full Model</h2>
<div id="global-model-3" class="section level3">
<h3>Global Model</h3>
<pre class="r"><code>H1_Full_ME_Sparrows &lt;- lme(Weight ~ Predator.Type + Flock.Size * Home.Range + TAvg + TSD,
  random = list(Population.Status = ~1),
  data = Sparrows_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Full_ME_Sparrows), resid(H1_Full_ME_Sparrows)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Full_ME_Sparrows), Sparrows_df$Weight) # Linearity, there is a clear pattern here --&gt; bad!
qqnorm(resid(H1_Full_ME_Sparrows)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Full_ME_Sparrows)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-30-1.png" width="1440" /></p>
</div>
<div id="central-north-american-model-3" class="section level3">
<h3>Central-/North-American Model</h3>
<pre class="r"><code>H1_Full_ME_CNA &lt;- lme(Weight ~ Flock.Size * Home.Range + TAvg + TSD,
  random = list(Index = ~1),
  data = CentralNorthAm_df
)
par(mfrow = c(2, 2))
plot(fitted(H1_Full_ME_CNA), resid(H1_Full_ME_CNA)) # Homogeneity of Variances, values around 0, no pattern --&gt; good!
plot(fitted(H1_Full_ME_CNA), CentralNorthAm_df$Weight) # Linearity, there is no clear pattern here --&gt; good!
qqnorm(resid(H1_Full_ME_CNA)) # Normality, residuals are normal distributed -&gt; good!
hist(leverage(H1_Full_ME_CNA)[, 1]) # Leverage, not really any outliers --&gt; good!</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-31-1.png" width="1440" /></p>
</div>
</div>
<div id="summary-of-mixed-effect-models" class="section level2">
<h2>Summary of Mixed Effect Models</h2>
<p>Mixed effect models are hard and I have certainly not given them full credit for what they are worth here. I highly suggest giving <a href="https://ourcodingclub.github.io/tutorials/mixed-models/#three">this</a> a read if you see yourself using mixed effect models.</p>
<p>For now, I want to carry along only the full models for our session on <a href="/courses/excursions-into-biostatistics/excursion-into-biostatistics/">Model Selection and Validation</a>:</p>
<pre class="r"><code>H1_ModelSparrows_ls$Mixed_Full &lt;- H1_Full_ME_Sparrows
H1_ModelCNA_ls$Mixed_Full &lt;- H1_Full_ME_CNA</code></pre>
</div>
</div>
<div id="generalised-linear-models" class="section level1">
<h1>Generalised Linear Models</h1>
<p>For a generalised linear model, we may want to run a logistic regression, which we <a href="/courses/excursions-into-biostatistics/classifications-order-from-chaos/#binary-logistic-regression-1">already did</a>.</p>
<p>For a different example, we now turn to <em>poisson models</em> by trying to understand how <code>Flock.Size</code> comes about.</p>
<p>Firstly, we limit our data set to necessary variables and then cut all duplicate rows:</p>
<pre class="r"><code>Flock_df &lt;- Sparrows_df[, c(&quot;Flock.Size&quot;, &quot;TAvg&quot;, &quot;TSD&quot;, &quot;Index&quot;, &quot;Climate&quot;, &quot;Predator.Type&quot;)]
Flock_df &lt;- unique(Flock_df)</code></pre>
<p>Now we are ready to build a basic linear model:</p>
<pre class="r"><code>Flock_lm &lt;- lm(Flock.Size ~ TAvg * TSD * Predator.Type, data = Flock_df)
par(mfrow = c(2, 2))
plot(Flock_lm)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-34-1.png" width="1440" /></p>
<p>Everything looks line but that Scale-Location plot. That one seems to indicate that variance in our <code>Flock.Size</code> increases as the <code>Flock.Size</code> itself increases - a very typical example of a poisson distributed variable.</p>
<p>GLMs to the rescue with the poisson GLM:</p>
<pre class="r"><code>poisson.model &lt;- glm(Flock.Size ~ TAvg * TSD * Predator.Type, data = Flock_df, family = poisson(link = &quot;log&quot;))
par(mfrow = c(2, 2))
plot(poisson.model)</code></pre>
<p><img src="/courses/Excursions into Biostatistics/6_Regressions---Correlations-for-the-Advanced_files/figure-html/unnamed-chunk-35-1.png" width="1440" />
We fixed it! Now just for the parameter estimates:</p>
<pre class="r"><code>summary(poisson.model)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Flock.Size ~ TAvg * TSD * Predator.Type, family = poisson(link = &quot;log&quot;), 
##     data = Flock_df)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.02420  -0.88953  -0.09629   0.94122   2.12737  
## 
## Coefficients: (1 not defined because of singularities)
##                                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                     -13.822674   2.540369  -5.441 5.29e-08 ***
## TAvg                              0.061744   0.008564   7.209 5.62e-13 ***
## TSD                               7.243621   1.056843   6.854 7.18e-12 ***
## Predator.TypeNon-Avian          -48.160439   9.412905  -5.116 3.11e-07 ***
## Predator.TypeNone                10.338971   8.694652   1.189    0.234    
## TAvg:TSD                         -0.026895   0.003936  -6.833 8.34e-12 ***
## TAvg:Predator.TypeNon-Avian       0.171883   0.033327   5.157 2.50e-07 ***
## TAvg:Predator.TypeNone           -0.039510   0.029180  -1.354    0.176    
## TSD:Predator.TypeNon-Avian        0.067442   0.041609   1.621    0.105    
## TSD:Predator.TypeNone            -6.742437   1.177538  -5.726 1.03e-08 ***
## TAvg:TSD:Predator.TypeNon-Avian         NA         NA      NA       NA    
## TAvg:TSD:Predator.TypeNone        0.025061   0.004321   5.800 6.64e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 276.538  on 49  degrees of freedom
## Residual deviance:  53.417  on 39  degrees of freedom
## AIC: 310.71
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="final-models" class="section level1">
<h1>Final Models</h1>
<p>In our upcoming <a href="/courses/excursions-into-biostatistics/excursion-into-biostatistics/">Model Selection and Validation</a> Session, we will look into how to compare and validate models. We now need to select some models we have created here today and want to carry forward to said session.</p>
<p>We have already created <code>list</code> objects for this purpose. Let’s save them alongside the data that was used to create them (in the case of the localised models, at least). Let’s save these as a separate object ready to be loaded into our <code>R</code> environment in the coming session:</p>
<pre class="r"><code>save(H1_ModelSparrows_ls, H1_ModelCNA_ls, CentralNorthAm_df, Sparrows_df, file = file.path(&quot;Data&quot;, &quot;H1_Models.RData&quot;))</code></pre>
</div>
<div id="sessioninfo" class="section level1">
<h1>SessionInfo</h1>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.5 (2021-03-31)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19041)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United Kingdom.1252    LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C                           
## [5] LC_TIME=English_United Kingdom.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] HLMdiag_0.5.0 nlme_3.1-152  ggplot2_3.3.3
## 
## loaded via a namespace (and not attached):
##  [1] styler_1.4.1      tidyselect_1.1.0  xfun_0.22         bslib_0.2.4       janitor_2.1.0     rematch2_2.1.2    purrr_0.3.4       reshape2_1.4.4    splines_4.0.5     lattice_0.20-41  
## [11] snakecase_0.11.0  colorspace_2.0-0  vctrs_0.3.7       generics_0.1.0    htmltools_0.5.1.1 yaml_2.2.1        mgcv_1.8-34       utf8_1.2.1        rlang_0.4.10      R.oo_1.24.0      
## [21] jquerylib_0.1.4   pillar_1.6.0      glue_1.4.2        withr_2.4.2       R.utils_2.10.1    R.cache_0.14.0    lifecycle_1.0.0   plyr_1.8.6        stringr_1.4.0     munsell_0.5.0    
## [31] blogdown_1.3      gtable_0.3.0      R.methodsS3_1.8.1 diagonals_6.0.0   evaluate_0.14     labeling_0.4.2    knitr_1.33        fansi_0.4.2       highr_0.9         Rcpp_1.0.6       
## [41] scales_1.1.1      backports_1.2.1   jsonlite_1.7.2    farver_2.1.0      digest_0.6.27     stringi_1.5.3     bookdown_0.22     dplyr_1.0.5       grid_4.0.5        tools_4.0.5      
## [51] magrittr_2.0.1    sass_0.3.1        tibble_3.1.1      crayon_1.4.1      pkgconfig_2.0.3   ellipsis_0.3.1    MASS_7.3-53.1     Matrix_1.3-2      lubridate_1.7.10  rmarkdown_2.7    
## [61] R6_2.5.0          compiler_4.0.5</code></pre>
</div>
